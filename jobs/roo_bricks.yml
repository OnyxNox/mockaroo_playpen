resources:
  jobs:
    roo_bricks:
      name: Roo Bricks
      tasks:
        - task_key: ForEach_Entity
          for_each_task:
            inputs: '["orders_products", "orders", "products", "users"]'
            task:
              task_key: Download_Entity
              spark_python_task:
                python_file: ../src/mockaroo_connector.py
                parameters:
                  - --output
                  - /Workspace/.output
                  - --run-id
                  - "{{job.run_id}}"
                  - "../.mockaroo/{{input}}.schema.json"
              environment_key: Default
        - task_key: ForEach_Downloaded_Entity
          depends_on:
            - task_key: ForEach_Entity
          for_each_task:
            inputs: '["orders_products", "orders", "products", "users"]'
            task:
              task_key: Ingest_Entity
              spark_python_task:
                python_file: ../src/data_loader.py
                parameters:
                  - --input
                  - /Workspace/.output
                  - --run-id
                  - "{{job.run_id}}"
                  - "{{input}}"
              environment_key: Default
      queue:
        enabled: true
      environments:
        - environment_key: Default
          spec:
            client: "4"
            dependencies:
              - python-dotenv==1.1.1
      performance_target: PERFORMANCE_OPTIMIZED
